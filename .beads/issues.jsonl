{"id":"spotter-0p7","title":"Setup Code Quality Tools (Credo, Dialyxir, mix_audit)","description":"## Problem\nSpotter has no automated code quality checks. No static analysis, type checking, or dependency vulnerability scanning.\n\n## Solution\nAdd three standard Elixir quality tools as dev dependencies:\n- **Credo** for static code analysis and style checking\n- **Dialyxir** for gradual type checking via Dialyzer\n- **mix_audit** for dependency vulnerability scanning\n\nInstall via mix igniter.install, generate Credo config, and add a unified mix quality alias.\n\n## Acceptance Tests\n- GIVEN tools installed WHEN mix quality runs THEN credo, dialyzer, and deps.audit all execute\n- GIVEN .credo.exs exists WHEN mix credo runs THEN project style rules are applied\n- GIVEN PLT built WHEN mix dialyzer runs THEN type analysis completes using cache\n\n## Rabbit Holes\n- Dialyzer PLT building is slow on first run (2+ minutes) — just document, don't optimize\n- Credo defaults may be strict — keep defaults, tune later\n\n## No-gos\n- No CI/CD integration yet (separate task)\n- No custom Credo checks\n- No fixing existing code to satisfy checkers\n\n---\nAppetite: small. Target: mix.exs, .credo.exs. Architecture: Igniter for dep installation. Sources: mix.exs.","status":"closed","priority":2,"issue_type":"epic","owner":"marco.rotili@handgemacht.ai","created_at":"2026-02-10T23:01:46.79978841+01:00","created_by":"Marco Rotili","updated_at":"2026-02-10T23:17:47.552797681+01:00","closed_at":"2026-02-10T23:17:47.552797681+01:00","close_reason":"Closed"}
{"id":"spotter-0p7.1","title":"Install quality tools and configure Credo","description":"Install Credo, Dialyxir, and mix_audit via Igniter, generate Credo config, and verify all tools work.\n\n**Output files:**\n- mix.exs — updated with three new dependencies\n- .credo.exs — generated Credo configuration\n- mix.lock — updated\n\n**Technical specs:**\n\nDependencies to add:\n```elixir\n{:credo, \"~\u003e 1.7\", only: [:dev, :test], runtime: false}\n{:dialyxir, \"~\u003e 1.4\", only: [:dev, :test], runtime: false}\n{:mix_audit, \"~\u003e 2.1\", only: [:dev, :test], runtime: false}\n```\n\n**Steps:**\n1. Run mix igniter.install credo dialyxir mix_audit — adds all three deps\n2. Run mix credo gen.config — generates .credo.exs with defaults\n3. Verify: mix credo list, mix dialyzer, mix deps.audit\n\n**Source references:**\n- mix.exs (lines 27-45): existing deps section\n\n**Edge cases:**\n- First mix dialyzer run takes 2-3 min building PLT — expected\n- Credo may report style issues in existing code — don't fix in this task\n- If igniter can't install, fall back to manual dep entry in mix.exs\n\n**Definition of Done:**\n- All three tools installed and runnable\n- .credo.exs exists with defaults\n- mix credo, mix dialyzer, mix deps.audit all complete","status":"closed","priority":2,"issue_type":"task","owner":"marco.rotili@handgemacht.ai","created_at":"2026-02-10T23:02:55.720268219+01:00","created_by":"Marco Rotili","updated_at":"2026-02-10T23:17:47.547868723+01:00","closed_at":"2026-02-10T23:17:47.547868723+01:00","close_reason":"Closed","dependencies":[{"issue_id":"spotter-0p7.1","depends_on_id":"spotter-0p7","type":"parent-child","created_at":"2026-02-10T23:02:55.722832403+01:00","created_by":"Marco Rotili"}]}
{"id":"spotter-0p7.2","title":"Add mix quality alias","description":"Add a mix quality alias to mix.exs that runs all three quality tools in sequence.\n\n**Output files (modify):**\n- mix.exs — add quality alias to aliases() function\n\n**Technical specs:**\n\nUpdate aliases() (currently at line 74-76):\n```elixir\ndefp aliases() do\n  [\n    test: [\"ash.setup --quiet\", \"test\"],\n    quality: [\"credo\", \"dialyzer\", \"deps.audit\"]\n  ]\nend\n```\n\nRuns in order: credo → dialyzer → deps.audit. Stops on first failure.\n\n**Source references:**\n- mix.exs aliases() function (lines 74-76)\n\n**Definition of Done:**\n- mix quality alias works and runs all three tools\n- All changes committed","status":"closed","priority":2,"issue_type":"task","owner":"marco.rotili@handgemacht.ai","created_at":"2026-02-10T23:02:57.673577227+01:00","created_by":"Marco Rotili","updated_at":"2026-02-10T23:17:47.550421777+01:00","closed_at":"2026-02-10T23:17:47.550421777+01:00","close_reason":"Closed","dependencies":[{"issue_id":"spotter-0p7.2","depends_on_id":"spotter-0p7","type":"parent-child","created_at":"2026-02-10T23:02:57.676222011+01:00","created_by":"Marco Rotili"},{"issue_id":"spotter-0p7.2","depends_on_id":"spotter-0p7.1","type":"blocks","created_at":"2026-02-10T23:03:47.704870595+01:00","created_by":"Marco Rotili"}]}
{"id":"spotter-0rt","title":"Index Claude Code Transcripts into Ash Domain","description":"## Problem\nSpotter needs to review Claude Code sessions, but transcripts are raw JSONL files scattered across ~/.claude/projects/. No way to query by project, time, tool usage, or conversation structure. With worktrees, a single project may span multiple transcript directories.\n\n## Solution\nBuild Spotter.Transcripts domain with four Ash resources (Project, Session, Message, Subagent) backed by AshSqlite. A runtime config file (priv/spotter.toml) defines tracked projects with regex patterns to match transcript directories (handling worktrees). An Oban job reads the config, scans matching directories, parses JSONL, and upserts into SQLite. Expose via AshJsonApi.\n\nConfig example (priv/spotter.toml):\n  [projects.spotter]\n  pattern = \"^-home-marco-projects-spotter\"\n\n  [projects.handgemacht]\n  pattern = \"^-home-marco-projects-handgemacht\"\n\n- Projects: defined in config, each matches one or more transcript directories via regex\n- Sessions: UUID .jsonl files with slug, timestamps, git branch, cwd\n- Messages: individual JSONL lines with type, role, content (stored as map), parent chain\n- Subagents: separate JSONL files in {sessionId}/subagents/\n\n## Acceptance Tests\n- GIVEN config has a project with pattern WHEN sync runs THEN only matching directories are scanned\n- GIVEN a project matches multiple worktree dirs WHEN synced THEN all sessions belong to one Project\n- GIVEN a session has subagent files WHEN sync runs THEN subagents created with correct linkage\n- GIVEN JSON API running WHEN GET /api/projects THEN configured project list returned\n- GIVEN session exists WHEN GET /api/sessions/:id with include=messages THEN session with messages returned\n\n## Rabbit Holes\n- Message content varies (string vs array of content blocks) - store as map, don't over-normalize\n- Large files (1MB+) - stream JSONL, don't load into memory\n- Tool result files in separate .txt - just store reference path for MVP\n- Regex pattern complexity - keep simple prefix patterns\n\n## No-gos\n- No full-text search indexing\n- No real-time sync (scheduled Oban job is fine)\n- No transcript modification (read-only)\n- No authentication (localhost prototype)\n- No LiveView UI yet (JSON API only)\n\n---\nAppetite: reviewed. Target: lib/spotter/transcripts/. Architecture: Ash 3.0, AshSqlite, Oban, AshJsonApi. Sources: config/config.exs, lib/spotter/repo.ex, lib/spotter_web/ash_json_api_router.ex.","status":"closed","priority":2,"issue_type":"epic","owner":"marco.rotili@handgemacht.ai","created_at":"2026-02-10T22:45:50.026673334+01:00","created_by":"Marco Rotili","updated_at":"2026-02-10T23:39:41.780932996+01:00","closed_at":"2026-02-10T23:39:41.780932996+01:00","close_reason":"Closed"}
{"id":"spotter-0rt.1","title":"Create Project Config and Domain + Project Resource","description":"Create the runtime config file, a config reader module, the Spotter.Transcripts domain, and Spotter.Transcripts.Project resource.\n\n**Output files:**\n- priv/spotter.toml - runtime config defining tracked projects\n- lib/spotter/transcripts/config.ex - config reader module\n- lib/spotter/transcripts.ex - domain module\n- lib/spotter/transcripts/project.ex - resource\n\n**Technical specs:**\n\nConfig file (priv/spotter.toml):\n  # Transcript source directory\n  transcripts_dir = \"~/.claude/projects\"\n  [projects.spotter]\n  pattern = \"^-home-marco-projects-spotter\"\n\nConfig reader (lib/spotter/transcripts/config.ex):\n- Spotter.Transcripts.Config module\n- read!/0 - reads and parses priv/spotter.toml, returns %{transcripts_dir: String.t(), projects: %{name =\u003e %{pattern: Regex.t()}}}\n- Expand ~ in paths. Compile regex patterns with Regex.compile!/1.\n- Add toml hex package to mix.exs dependencies for TOML parsing\n\nDomain (lib/spotter/transcripts.ex): use Ash.Domain, extensions: [AshJsonApi.Domain]. Resources section lists all four resources.\n\nProject resource attributes:\n- id (uuid_v7, primary key)\n- name (string, required) - config key like \"spotter\"\n- pattern (string, required) - regex pattern string like \"^-home-marco-projects-spotter\"\n- inserted_at / updated_at (create/update timestamps)\n\nIdentity: unique_name on name\nRelationships: has_many :sessions, Spotter.Transcripts.Session\nData layer: AshSqlite.DataLayer, table \"projects\", repo Spotter.Repo\nActions: :create, :read (get + list), :update, :destroy\n\n**Source references:** lib/spotter/repo.ex, config/config.exs (Spark formatter section_order)\n\n**Edge cases:**\n- TOML parsing: use toml hex package (add to mix.exs deps)\n- Path expansion: String.replace(path, \"~\", System.user_home!())\n- Regex patterns should be validated at config read time\n\n**Definition of Done:**\n- All requirements implemented\n- Tests exist and pass","status":"closed","priority":2,"issue_type":"task","owner":"marco.rotili@handgemacht.ai","created_at":"2026-02-10T22:46:05.115176095+01:00","created_by":"Marco Rotili","updated_at":"2026-02-10T23:39:41.759895126+01:00","closed_at":"2026-02-10T23:39:41.759895126+01:00","close_reason":"Closed","dependencies":[{"issue_id":"spotter-0rt.1","depends_on_id":"spotter-0rt","type":"parent-child","created_at":"2026-02-10T22:46:05.116689937+01:00","created_by":"Marco Rotili"}]}
{"id":"spotter-0rt.2","title":"Create Session Resource","description":"Create Spotter.Transcripts.Session resource for individual Claude Code sessions.\n\n**Output files:** lib/spotter/transcripts/session.ex\n\n**Technical specs:**\n\nAttributes:\n- id (uuid_v7, primary key)\n- session_id (uuid, required) - Claude session UUID from filename/content\n- slug (string, optional) - e.g. \"jaunty-bouncing-orbit\"\n- project_id (uuid, required, FK)\n- transcript_dir (string, required) - which transcript directory this came from (e.g. -home-marco-projects-spotter)\n- cwd (string, optional)\n- git_branch (string, optional)\n- version (string, optional) - Claude Code version e.g. \"2.1.38\"\n- started_at / ended_at (utc_datetime_usec, optional)\n- schema_version (integer, required, default: 1) - parser-detected format version. Bumped when Claude Code changes JSONL structure.\n- message_count (integer, optional)\n- inserted_at / updated_at (timestamps)\n\nIdentity: unique_session_id on session_id\nRelationships: belongs_to :project, has_many :messages, has_many :subagents\nData layer: AshSqlite.DataLayer, table \"sessions\", repo Spotter.Repo\n\n**Source references:** lib/spotter/transcripts/project.ex, example JSONL fields: sessionId, slug, cwd, gitBranch, version, timestamp\n\n**Edge cases:** Some sessions lack slug. Timestamps are ISO 8601 strings. message_count computed during ingestion. transcript_dir tracks which worktree directory the session came from.\n\n**Definition of Done:**\n- All requirements implemented\n- Tests exist and pass","status":"closed","priority":2,"issue_type":"task","owner":"marco.rotili@handgemacht.ai","created_at":"2026-02-10T22:46:09.881804569+01:00","created_by":"Marco Rotili","updated_at":"2026-02-10T23:39:41.762600162+01:00","closed_at":"2026-02-10T23:39:41.762600162+01:00","close_reason":"Closed","dependencies":[{"issue_id":"spotter-0rt.2","depends_on_id":"spotter-0rt","type":"parent-child","created_at":"2026-02-10T22:46:09.884041802+01:00","created_by":"Marco Rotili"},{"issue_id":"spotter-0rt.2","depends_on_id":"spotter-0rt.1","type":"blocks","created_at":"2026-02-10T22:46:37.29036777+01:00","created_by":"Marco Rotili"}]}
{"id":"spotter-0rt.3","title":"Create Message Resource","description":"Create Spotter.Transcripts.Message for individual transcript messages.\n\n**Output files:** lib/spotter/transcripts/message.ex\n\n**Technical specs:**\n\nAttributes:\n- id (uuid_v7, primary key)\n- uuid (string, required) - message UUID from JSONL\n- session_id (uuid, required, FK)\n- parent_uuid (string, optional) - tree structure reference (not an Ash relationship)\n- message_id (string, optional)\n- type (atom, required) - :user, :assistant, :tool_use, :tool_result, :progress, :thinking, :system, :file_history_snapshot\n- role (atom, optional) - :user, :assistant, :system\n- content (map, optional) - full content stored as map/JSON\n- timestamp (utc_datetime_usec, required)\n- is_sidechain (boolean, default: false)\n- agent_id (string, optional)\n- tool_use_id (string, optional)\n- inserted_at / updated_at\n\nRelationships: belongs_to :session\nData layer: AshSqlite.DataLayer, table \"messages\", repo Spotter.Repo\n\n**Source references:** lib/spotter/transcripts/session.ex. Example: {\"uuid\":\"...\",\"type\":\"user\",\"message\":{\"role\":\"user\",\"content\":\"...\"},\"timestamp\":\"...\"}. Assistant content can be string or array of {type, text} blocks.\n\n**Edge cases:** Content varies between string and array - store as-is in map. Some messages lack timestamp - skip or nil. Tool result files referenced by path only.\n\n**Definition of Done:**\n- All requirements implemented\n- Tests exist and pass","status":"closed","priority":2,"issue_type":"task","owner":"marco.rotili@handgemacht.ai","created_at":"2026-02-10T22:46:15.020736203+01:00","created_by":"Marco Rotili","updated_at":"2026-02-10T23:39:41.765284217+01:00","closed_at":"2026-02-10T23:39:41.765284217+01:00","close_reason":"Closed","dependencies":[{"issue_id":"spotter-0rt.3","depends_on_id":"spotter-0rt.2","type":"blocks","created_at":"2026-02-10T22:46:37.426411403+01:00","created_by":"Marco Rotili"},{"issue_id":"spotter-0rt.3","depends_on_id":"spotter-0rt","type":"parent-child","created_at":"2026-02-10T22:46:15.022187275+01:00","created_by":"Marco Rotili"}]}
{"id":"spotter-0rt.4","title":"Create Subagent Resource","description":"Create Spotter.Transcripts.Subagent for subagent sessions.\n\n**Output files:** lib/spotter/transcripts/subagent.ex\n\n**Technical specs:**\n\nAttributes:\n- id (uuid_v7, primary key)\n- agent_id (string, required) - short hex like \"a78b257\"\n- session_id (uuid, required, FK)\n- slug (string, optional)\n- started_at / ended_at (utc_datetime_usec, optional)\n- message_count (integer, optional)\n- inserted_at / updated_at\n\nIdentity: unique_agent_per_session on [:session_id, :agent_id]\nRelationships: belongs_to :session\nData layer: AshSqlite.DataLayer, table \"subagents\", repo Spotter.Repo\n\n**Source references:** lib/spotter/transcripts/session.ex. Subagent files at {sessionId}/subagents/agent-{agentId}.jsonl.\n\n**Edge cases:** Skip has_many :messages for MVP - query by agent_id separately.\n\n**Definition of Done:**\n- All requirements implemented\n- Tests exist and pass","status":"closed","priority":2,"issue_type":"task","owner":"marco.rotili@handgemacht.ai","created_at":"2026-02-10T22:46:17.723950503+01:00","created_by":"Marco Rotili","updated_at":"2026-02-10T23:39:41.767834552+01:00","closed_at":"2026-02-10T23:39:41.767834552+01:00","close_reason":"Closed","dependencies":[{"issue_id":"spotter-0rt.4","depends_on_id":"spotter-0rt","type":"parent-child","created_at":"2026-02-10T22:46:17.725890276+01:00","created_by":"Marco Rotili"},{"issue_id":"spotter-0rt.4","depends_on_id":"spotter-0rt.2","type":"blocks","created_at":"2026-02-10T22:46:37.615726218+01:00","created_by":"Marco Rotili"}]}
{"id":"spotter-0rt.5","title":"Build JSONL Parser Module","description":"Create Spotter.Transcripts.JsonlParser to parse .jsonl transcript files.\n\n**Output files:** lib/spotter/transcripts/jsonl_parser.ex\n\n**Technical specs:**\n\nPublic functions:\n- parse_session_file(path) -\u003e {:ok, %{session_id, slug, cwd, git_branch, version, schema_version, started_at, ended_at, messages}} or {:error, reason}\n- parse_subagent_file(path) -\u003e same structure plus agent_id\n- detect_schema_version(first_messages) -\u003e integer (1 for current format, bump when format changes)\n\nImplementation:\n- Use File.stream!/1 for line-by-line reading (memory-safe for large files)\n- Jason.decode/1 each line, skip malformed lines with Logger warning\n- Extract session metadata from first messages with sessionId, slug, etc.\n- Detect schema version from message structure (presence/absence of fields, content format)\n- Normalize content per schema version: v1 uses message[\"message\"][\"content\"] || message[\"content\"]\n- Parse timestamps with DateTime.from_iso8601/1\n- Return plain maps with schema_version included - Oban job calls Ash actions to persist\n\nSchema version detection: Currently only v1 exists. When Claude Code changes format, add a new version detector clause. Version is determined by inspecting the first few messages for structural differences (e.g. new fields, changed content format).\n\n**Source references:** Example files at ~/.claude/projects/-home-marco-projects-spotter/*.jsonl\n\n**Edge cases:** Large files must stream. Some lines have invalid JSON. Content can be string or array. Some messages lack timestamps.\n\n**Definition of Done:**\n- All requirements implemented\n- Tests exist and pass","status":"closed","priority":2,"issue_type":"task","owner":"marco.rotili@handgemacht.ai","created_at":"2026-02-10T22:46:22.66075677+01:00","created_by":"Marco Rotili","updated_at":"2026-02-10T23:39:41.770456936+01:00","closed_at":"2026-02-10T23:39:41.770456936+01:00","close_reason":"Closed","dependencies":[{"issue_id":"spotter-0rt.5","depends_on_id":"spotter-0rt","type":"parent-child","created_at":"2026-02-10T22:46:22.662334462+01:00","created_by":"Marco Rotili"},{"issue_id":"spotter-0rt.5","depends_on_id":"spotter-0rt.3","type":"blocks","created_at":"2026-02-10T22:46:37.758761201+01:00","created_by":"Marco Rotili"}]}
{"id":"spotter-0rt.6","title":"Build Transcript Sync Oban Job","description":"Create Spotter.Transcripts.Jobs.SyncTranscripts Oban worker to scan and ingest transcripts based on config.\n\n**Output files:** lib/spotter/transcripts/jobs/sync_transcripts.ex\n\n**Technical specs:**\n\nuse Oban.Worker, queue: :default, max_attempts: 3\n\nFunctions:\n- sync_all/0 - reads Spotter.Transcripts.Config, for each configured project: lists dirs in transcripts_dir matching the project's regex pattern, enqueues one job per project\n- perform(%Oban.Job{args: %{\"project_name\" =\u003e name, \"pattern\" =\u003e pattern}}):\n  1. Upsert project via Ash action (match on name identity)\n  2. List transcript dirs matching regex in ~/.claude/projects/\n  3. For each matching dir, list .jsonl files\n  4. For each file: parse with JsonlParser, upsert session (with transcript_dir), bulk create messages\n  5. Scan {session_id}/subagents/ dirs, parse subagent files, upsert subagents + messages\n\nUse Ash.bulk_create! for messages (batch 500). Skip already-synced sessions (check existence by session_id).\n\n**Source references:** lib/spotter/transcripts/config.ex, lib/spotter/transcripts/jsonl_parser.ex, all resource files, config/config.exs (Oban queues)\n\n**Edge cases:** Empty dirs - skip. Duplicate runs - upsert handles it. Large sessions - batch inserts. Missing subagent dirs - check existence.\n\n**Definition of Done:**\n- All requirements implemented\n- Tests exist and pass","status":"closed","priority":2,"issue_type":"task","owner":"marco.rotili@handgemacht.ai","created_at":"2026-02-10T22:46:27.29327182+01:00","created_by":"Marco Rotili","updated_at":"2026-02-10T23:39:41.773956273+01:00","closed_at":"2026-02-10T23:39:41.773956273+01:00","close_reason":"Closed","dependencies":[{"issue_id":"spotter-0rt.6","depends_on_id":"spotter-0rt.5","type":"blocks","created_at":"2026-02-10T22:46:37.914959805+01:00","created_by":"Marco Rotili"},{"issue_id":"spotter-0rt.6","depends_on_id":"spotter-0rt.4","type":"blocks","created_at":"2026-02-10T22:46:38.111813802+01:00","created_by":"Marco Rotili"},{"issue_id":"spotter-0rt.6","depends_on_id":"spotter-0rt","type":"parent-child","created_at":"2026-02-10T22:46:27.294705633+01:00","created_by":"Marco Rotili"}]}
{"id":"spotter-0rt.7","title":"Register Domain, Generate Migrations, Wire Up","description":"Register Spotter.Transcripts domain in config and router, add toml dep, generate and run migrations.\n\n**Output files (modify):**\n- mix.exs - add {:toml, \"~\u003e 0.7\"} to deps\n- config/config.exs - add Spotter.Transcripts to ash_domains\n- lib/spotter_web/ash_json_api_router.ex - add Spotter.Transcripts to domains\n- priv/repo/migrations/ - generated migration files\n\n**Steps:**\n1. Add toml dep to mix.exs, run mix deps.get\n2. config/config.exs: change ash_domains: [] to ash_domains: [Spotter.Transcripts]\n3. ash_json_api_router.ex: change domains: [] to domains: [Spotter.Transcripts]\n4. Run mix ash.codegen --name add_transcripts_domain\n5. Run mix ash.migrate\n6. Verify: mix phx.server then curl localhost:1100/api/projects\n\n**Source references:** config/config.exs (line 12), lib/spotter_web/ash_json_api_router.ex (line 3), mix.exs\n\n**Definition of Done:**\n- All requirements implemented\n- No unrelated changes\n- Tests exist and pass\n- JSON API responds at /api/projects","status":"closed","priority":2,"issue_type":"task","owner":"marco.rotili@handgemacht.ai","created_at":"2026-02-10T22:46:31.250920107+01:00","created_by":"Marco Rotili","updated_at":"2026-02-10T23:39:41.77778624+01:00","closed_at":"2026-02-10T23:39:41.77778624+01:00","close_reason":"Closed","dependencies":[{"issue_id":"spotter-0rt.7","depends_on_id":"spotter-0rt","type":"parent-child","created_at":"2026-02-10T22:46:31.253450621+01:00","created_by":"Marco Rotili"},{"issue_id":"spotter-0rt.7","depends_on_id":"spotter-0rt.6","type":"blocks","created_at":"2026-02-10T22:46:38.31548154+01:00","created_by":"Marco Rotili"}]}
{"id":"spotter-1o8","title":"Text selection and annotation creation UI","description":"Wire xterm.js onSelectionChange to LiveView events. Add annotation form and list in right panel. Persist via Ash. Files: assets/js/app.js, lib/spotter_web/live/pane_view_live.ex","status":"closed","priority":2,"issue_type":"task","owner":"marco.rotili@handgemacht.ai","created_at":"2026-02-11T00:12:37.10641504+01:00","created_by":"Marco Rotili","updated_at":"2026-02-11T00:23:32.959506881+01:00","closed_at":"2026-02-11T00:23:32.959506881+01:00","close_reason":"Closed","dependencies":[{"issue_id":"spotter-1o8","depends_on_id":"spotter-al1","type":"blocks","created_at":"2026-02-11T00:12:44.152153002+01:00","created_by":"Marco Rotili"},{"issue_id":"spotter-1o8","depends_on_id":"spotter-wum","type":"blocks","created_at":"2026-02-11T00:12:44.335315966+01:00","created_by":"Marco Rotili"},{"issue_id":"spotter-1o8","depends_on_id":"spotter-yku","type":"parent-child","created_at":"2026-02-11T00:12:50.728952182+01:00","created_by":"Marco Rotili"}]}
{"id":"spotter-3zm","title":"Tmux terminal viewer prototype","description":"Epic: Build a Spotter prototype that discovers tmux panes running Claude Code, lists them in a LiveView page, and connects to selected panes via tmux control mode streaming terminal output to xterm.js in the browser with bidirectional I/O support. Stack: Phoenix LiveView + Channels, xterm.js, tmux control mode via Port.","status":"closed","priority":1,"issue_type":"feature","owner":"marco.rotili@handgemacht.ai","created_at":"2026-02-10T22:39:13.972132212+01:00","created_by":"Marco Rotili","updated_at":"2026-02-10T22:46:19.679052125+01:00","closed_at":"2026-02-10T22:46:19.679052125+01:00","close_reason":"Closed"}
{"id":"spotter-5pf","title":"Show session transcripts in dashboard with live sync progress","description":"## Problem\nThe dashboard only shows tmux panes. There's no way to see synced session transcripts or trigger/monitor a sync. Only the spotter project is configured — aufgabenschmiede worktrees are missing.\n\n## Solution\n1. Add aufgabenschmiede project to spotter.toml\n2. Add PubSub broadcasts from the sync Oban worker so the dashboard can track progress\n3. Add a Session Transcripts section to the dashboard showing projects + sessions from DB, with a Sync button that shows live progress (per-project: syncing/done/error)\n\n## Acceptance Tests\n- GIVEN the app is running WHEN I visit / THEN I see projects and their sessions from the DB\n- GIVEN I click Sync WHEN sync runs THEN I see per-project progress updating in real-time (syncing → completed with stats)\n- GIVEN sync completes WHEN the dashboard updates THEN session list refreshes with new data\n- GIVEN spotter.toml has aufgabenschmiede WHEN sync runs THEN it discovers aufgabenschmiede transcripts\n\n## Rabbit Holes\n- Don't paginate sessions yet\n- Don't add per-session progress — only per-project\n\n## No-gos\n- No session detail view\n- No editing project config from UI\n- No Oban cron scheduling\n\n---\nRig: spotter. Appetite: supervised.\nTarget: lib/spotter/, lib/spotter_web/live/, priv/.\nArchitecture: Ash, Phoenix LiveView, Oban, PubSub.\nSources: lib/spotter/transcripts/jobs/sync_transcripts.ex, lib/spotter_web/live/pane_list_live.ex, priv/spotter.toml.","status":"closed","priority":2,"issue_type":"epic","owner":"marco.rotili@handgemacht.ai","created_at":"2026-02-11T00:12:29.720319033+01:00","created_by":"Marco Rotili","updated_at":"2026-02-11T00:21:42.215730624+01:00","closed_at":"2026-02-11T00:21:42.215730624+01:00","close_reason":"Closed"}
{"id":"spotter-5pf.1","title":"Configure dev projects in spotter.toml","description":"Add aufgabenschmiede worktrees project to priv/spotter.toml.\n\nOutput files: priv/spotter.toml\n\nTechnical specs:\nAufgabenschmiede worktrees live under ~/projects/handgemacht/aufgabenschmiede/, so their Claude Code transcript dirs match -home-marco-projects-handgemacht-aufgabenschmiede*. The existing spotter pattern ^-home-marco-projects-spotter already matches worktrees (prefix match) — no change needed there.\n\nAdd:\n[projects.aufgabenschmiede]\npattern = \"^-home-marco-projects-handgemacht-aufgabenschmiede\"\n\nSource references: priv/spotter.toml, lib/spotter/transcripts/config.ex, lib/spotter/transcripts/jobs/sync_transcripts.ex line 68\n\nDefinition of Done:\n- The new project entry exists in spotter.toml\n- Spotter.Transcripts.Config.read!/0 returns both projects","status":"closed","priority":2,"issue_type":"task","owner":"marco.rotili@handgemacht.ai","created_at":"2026-02-11T00:12:36.318061479+01:00","created_by":"Marco Rotili","updated_at":"2026-02-11T00:17:18.015084063+01:00","closed_at":"2026-02-11T00:17:18.015084063+01:00","close_reason":"Closed","dependencies":[{"issue_id":"spotter-5pf.1","depends_on_id":"spotter-5pf","type":"parent-child","created_at":"2026-02-11T00:12:36.319835434+01:00","created_by":"Marco Rotili"}]}
{"id":"spotter-5pf.2","title":"Broadcast sync progress via PubSub","description":"Add PubSub broadcasting to SyncTranscripts so the dashboard can show real-time sync status per project.\n\nOutput files: lib/spotter/transcripts/jobs/sync_transcripts.ex\n\nTechnical specs:\nBroadcast on topic sync:progress via Spotter.PubSub. Messages (all tuples):\n- {:sync_started, %{project: name}} — at start of perform/1, after pattern compilation\n- {:sync_completed, %{project: name, dirs_synced: count, sessions_synced: count, duration_ms: integer}} — at end of perform/1\n- {:sync_error, %{project: name, error: String.t()}} — on failure\n\nUse Phoenix.PubSub.broadcast(Spotter.PubSub, \"sync:progress\", message).\n\nAdd timing with System.monotonic_time(:millisecond) at start of perform. Count dirs and sessions processed. Wrap main loop in try/rescue to broadcast error on failure.\n\nSource references: lib/spotter/transcripts/jobs/sync_transcripts.ex, lib/spotter/application.ex (PubSub already supervised)\n\nArchitecture constraints: Use existing Spotter.PubSub. No new processes.\n\nDefinition of Done:\n- All requirements implemented\n- PubSub messages are broadcast at sync start, completion, and on error","status":"closed","priority":2,"issue_type":"task","owner":"marco.rotili@handgemacht.ai","created_at":"2026-02-11T00:12:39.937727666+01:00","created_by":"Marco Rotili","updated_at":"2026-02-11T00:17:46.258028856+01:00","closed_at":"2026-02-11T00:17:46.258028856+01:00","close_reason":"Closed","dependencies":[{"issue_id":"spotter-5pf.2","depends_on_id":"spotter-5pf","type":"parent-child","created_at":"2026-02-11T00:12:39.939909492+01:00","created_by":"Marco Rotili"}]}
{"id":"spotter-5pf.3","title":"Show session transcripts with live sync progress in dashboard","description":"Add a Session Transcripts section to the dashboard that shows projects + sessions from DB and displays live sync progress when Sync is clicked.\n\nOutput files: lib/spotter_web/live/pane_list_live.ex\n\nTechnical specs:\n\nData loading: Query projects with sessions:\nSpotter.Transcripts.Project\n|\u003e Ash.Query.load(sessions: Ash.Query.sort(Spotter.Transcripts.Session, started_at: :desc))\n|\u003e Ash.read!()\n\nState: Add assigns:\n- projects — list of projects with loaded sessions\n- sync_status — map of project name → status atom (:idle | :syncing | :completed | :error)\n- sync_stats — map of project name → stats map (dirs_synced, sessions_synced, duration_ms, or error)\n\nMount: Subscribe to sync:progress. Load projects. Initialize sync_status as %{} and sync_stats as %{}.\n\nEvent handlers:\n- handle_event(\"sync_transcripts\", ...) — calls SyncTranscripts.sync_all(), sets all known project names to :syncing in sync_status\n- handle_info({:sync_started, %{project: name}}, ...) — set project status to :syncing\n- handle_info({:sync_completed, data}, ...) — set status to :completed, store stats, reload projects from DB\n- handle_info({:sync_error, data}, ...) — set status to :error, store error message\n\nRender: Add section after the header div, before Claude Code Sessions. For each project: show name, session count, sync status indicator. For each session: show slug (fall back to short session_id), git_branch, message_count, and relative time for started_at.\n\nSync status indicators: :syncing → syncing... with subtle animation, :completed → green checkmark with N dirs and Nms, :error → red X with error message, :idle → nothing shown.\n\nUse inline styles consistent with existing dashboard dark theme.\n\nRelative time helper: Add a private function relative_time/1 that shows Xm ago, Xh ago, Xd ago based on DateTime.diff(DateTime.utc_now(), dt, :second).\n\nSource references: lib/spotter_web/live/pane_list_live.ex, lib/spotter/transcripts/project.ex (has_many :sessions), lib/spotter/transcripts/session.ex (slug, git_branch, message_count, started_at), lib/spotter/transcripts/jobs/sync_transcripts.ex\n\nEdge cases: Handle empty projects list (No projects synced yet. Click Sync to start.). Handle projects with 0 sessions. Handle nil started_at. Handle nil slug (show first 8 chars of session_id).\n\nArchitecture constraints: Ash queries, not raw Ecto. Inline HEEx, no new component files. Follow existing patterns in pane_list_live.ex.\n\nDefinition of Done:\n- All requirements implemented\n- Visiting / shows projects with their sessions\n- Clicking Sync shows per-project progress updating live\n- After sync, session list refreshes with new data\n- Tests to verify the behaviour exist or were added, and executed and pass","status":"closed","priority":2,"issue_type":"task","owner":"marco.rotili@handgemacht.ai","created_at":"2026-02-11T00:12:45.550166258+01:00","created_by":"Marco Rotili","updated_at":"2026-02-11T00:21:42.053778644+01:00","closed_at":"2026-02-11T00:21:42.053778644+01:00","close_reason":"Closed","dependencies":[{"issue_id":"spotter-5pf.3","depends_on_id":"spotter-5pf","type":"parent-child","created_at":"2026-02-11T00:12:45.552375444+01:00","created_by":"Marco Rotili"},{"issue_id":"spotter-5pf.3","depends_on_id":"spotter-5pf.2","type":"blocks","created_at":"2026-02-11T00:12:48.564189891+01:00","created_by":"Marco Rotili"}]}
{"id":"spotter-6vs","title":"Transcript-Terminal Scroll Sync Spike","description":"## Problem\n\nSpotter renders terminal output via xterm.js (tmux capture) and has parsed transcript data (Session/Message from JSONL). These are completely disconnected — there's no way to navigate between what's on screen in the terminal and which transcript message produced it.\n\n## Solution\n\nBuild a pseudo-renderer that converts transcript messages into the same text Claude Code would render in the terminal. Then add a transcript panel beside the terminal and sync scroll positions by matching visible terminal text against pseudo-rendered output.\n\nApproach: TDD — capture real transcript+terminal fixture pairs first, write tests, then implement.\n\n## Acceptance Tests\n\n- GIVEN a JSONL transcript and its corresponding terminal capture WHEN the pseudo-renderer processes the JSONL THEN each rendered line appears in the terminal capture\n- GIVEN a pane view with a selected session WHEN the user scrolls the terminal THEN the transcript panel scrolls to the corresponding message\n- GIVEN transcript messages of type tool_use WHEN rendered THEN they show with ● prefix matching Claude Code format\n\n## Rabbit Holes\n\n- Exact fidelity of pseudo-renderer to Claude Code's rendering — this is a spike, approximate is fine\n- Subagent transcript rendering — out of scope\n- Bidirectional sync (click transcript → scroll terminal) — out of scope\n\n## No-gos\n\n- No persistent pane↔session association (dropdown selection in memory only)\n- No reverse scroll sync\n- No subagent support\n- No syntax highlighting in transcript panel\n\n---\nAppetite: supervised. Target: lib/spotter/services/, test/. Architecture: Ash/Phoenix/LiveView/xterm.js. Sources: lib/spotter_web/live/pane_view_live.ex, assets/js/app.js, lib/spotter/transcripts/message.ex, ~/.claude/projects/-home-marco-projects-spotter/*.jsonl.","status":"open","priority":2,"issue_type":"epic","owner":"marco.rotili@handgemacht.ai","created_at":"2026-02-11T11:27:58.539813076+01:00","created_by":"Marco Rotili","updated_at":"2026-02-11T11:27:58.539813076+01:00"}
{"id":"spotter-6vs.1","title":"Capture transcript+terminal fixture pairs","description":"Capture 3 real transcript+terminal pairs as test fixtures for TDD.\n\nPick 3 sessions from ~/.claude/projects/-home-marco-projects-spotter/ with different characteristics:\n1. A short session (few tool calls)\n2. A session with many tool_use/tool_result pairs  \n3. A session with subagent spawns (Task tool)\n\nFor each session:\na. Copy the JSONL file to test/fixtures/transcripts/\u003cname\u003e.jsonl (use descriptive names: short, tool_heavy, subagent)\nb. Resume it with claude --resume \u003csession_id\u003e in a tmux pane\nc. Capture terminal: tmux capture-pane -t \u003cpane\u003e -p -S - \u003e test/fixtures/transcripts/\u003cname\u003e.terminal.txt\nd. Capture stripped version: tmux capture-pane -t \u003cpane\u003e -p -S - | sed 's/\\x1b\\[[0-9;]*m//g' \u003e test/fixtures/transcripts/\u003cname\u003e.terminal.stripped.txt\n\nOutput files:\n- test/fixtures/transcripts/short.jsonl\n- test/fixtures/transcripts/short.terminal.txt\n- test/fixtures/transcripts/short.terminal.stripped.txt\n- test/fixtures/transcripts/tool_heavy.jsonl\n- test/fixtures/transcripts/tool_heavy.terminal.txt\n- test/fixtures/transcripts/tool_heavy.terminal.stripped.txt\n- test/fixtures/transcripts/subagent.jsonl\n- test/fixtures/transcripts/subagent.terminal.txt\n- test/fixtures/transcripts/subagent.terminal.stripped.txt\n\nSource references: ~/.claude/projects/-home-marco-projects-spotter/*.jsonl\n\nDefinition of Done:\n- All 9 fixture files exist and are non-empty\n- Terminal captures contain recognizable Claude Code output (● markers, ⎿ results)","status":"open","priority":2,"issue_type":"task","owner":"marco.rotili@handgemacht.ai","created_at":"2026-02-11T11:28:07.598143617+01:00","created_by":"Marco Rotili","updated_at":"2026-02-11T11:28:07.598143617+01:00","dependencies":[{"issue_id":"spotter-6vs.1","depends_on_id":"spotter-6vs","type":"parent-child","created_at":"2026-02-11T11:28:07.601364164+01:00","created_by":"Marco Rotili"}]}
{"id":"spotter-6vs.2","title":"Write transcript renderer tests (TDD - tests first)","description":"Write tests for the pseudo-renderer BEFORE implementing it. Tests load real fixtures captured in spotter-6vs.1 and assert rendering correctness.\n\nCreate test/spotter/services/transcript_renderer_test.exs with:\n\n1. Fixture-based integration tests (for each of the 3 fixtures):\n   - Rendered lines appear in terminal capture (substring match against stripped terminal text)\n   - tool_use messages render with ● prefix\n   - All visible message types (assistant, tool_use, tool_result, user) produce at least one rendered line\n   - Each rendered line maps back to a valid message UUID\n\n2. Unit tests:\n   - strip_ansi/1: removes color codes (\\e[31m...\\e[0m → plain text), bold, underline, reset sequences\n   - extract_text/1: handles %{\"text\" =\u003e t}, %{\"blocks\" =\u003e [...]}, nil content\n   - render_message/1: individual tests for each message type (assistant text, tool_use, tool_result, user input, thinking/progress/system skip)\n\nOutput files:\n- test/spotter/services/transcript_renderer_test.exs\n\nSource references:\n- test/fixtures/transcripts/*.jsonl (from spotter-6vs.1)\n- test/fixtures/transcripts/*.terminal.stripped.txt (from spotter-6vs.1)\n- lib/spotter/transcripts/jsonl_parser.ex (for parsing fixture JSONL)\n- lib/spotter/transcripts/message.ex (message schema/types)\n\nArchitecture constraints: Use ExUnit, async: true. Parse fixtures with JsonlParser or inline JSON decoding.\n\nDefinition of Done:\n- Test file compiles (module under test can be a stub)\n- Tests fail because TranscriptRenderer is not yet implemented (red phase of TDD)","status":"open","priority":2,"issue_type":"task","owner":"marco.rotili@handgemacht.ai","created_at":"2026-02-11T11:28:20.629693622+01:00","created_by":"Marco Rotili","updated_at":"2026-02-11T11:28:20.629693622+01:00","dependencies":[{"issue_id":"spotter-6vs.2","depends_on_id":"spotter-6vs","type":"parent-child","created_at":"2026-02-11T11:28:20.631869267+01:00","created_by":"Marco Rotili"},{"issue_id":"spotter-6vs.2","depends_on_id":"spotter-6vs.1","type":"blocks","created_at":"2026-02-11T11:28:51.12860286+01:00","created_by":"Marco Rotili"}]}
{"id":"spotter-6vs.3","title":"Implement pseudo-renderer (make tests pass)","description":"Implement the TranscriptRenderer module to make all tests from spotter-6vs.2 pass.\n\nCreate lib/spotter/services/transcript_renderer.ex with:\n\n- render(messages) → list of %{line: string, message_id: string, type: atom, line_number: integer}\n- render_message(message) → list of line strings for a single message\n- strip_ansi(text) → text with ANSI escape codes removed (regex: ~r/\\e\\[[0-9;]*[a-zA-Z]/)\n- extract_text(message) → plain text from message content map\n\nRendering rules (refine against fixtures):\n- assistant with text block → plain text lines\n- assistant with tool_use block → \"● ToolName(first_arg_preview)\"\n- user with tool_result → \"  ⎿  result_preview\" (indented, truncated to ~5 lines)\n- user with plain text → user input text\n- thinking → skip or single line\n- progress, system, file_history_snapshot → skip\n\nOutput files:\n- lib/spotter/services/transcript_renderer.ex\n\nSource references:\n- test/spotter/services/transcript_renderer_test.exs (tests to satisfy)\n- test/fixtures/transcripts/*.jsonl (fixture data)\n- test/fixtures/transcripts/*.terminal.stripped.txt (ground truth)\n- lib/spotter/transcripts/message.ex (message type atoms)\n\nEdge cases:\n- Messages with nil content\n- Empty text blocks\n- Very long tool results (truncate)\n- Multiple blocks in single assistant message\n\nDefinition of Done:\n- All tests in transcript_renderer_test.exs pass\n- mix compile --warnings-as-errors clean","status":"open","priority":2,"issue_type":"task","owner":"marco.rotili@handgemacht.ai","created_at":"2026-02-11T11:28:30.717410195+01:00","created_by":"Marco Rotili","updated_at":"2026-02-11T11:28:30.717410195+01:00","dependencies":[{"issue_id":"spotter-6vs.3","depends_on_id":"spotter-6vs","type":"parent-child","created_at":"2026-02-11T11:28:30.720685641+01:00","created_by":"Marco Rotili"},{"issue_id":"spotter-6vs.3","depends_on_id":"spotter-6vs.2","type":"blocks","created_at":"2026-02-11T11:28:51.298324106+01:00","created_by":"Marco Rotili"}]}
{"id":"spotter-6vs.4","title":"Add transcript panel and scroll sync to PaneViewLive","description":"Add a transcript panel beside the terminal in PaneViewLive and wire up scroll sync.\n\nModify lib/spotter_web/live/pane_view_live.ex:\n- New assigns: session (nil), messages ([]), rendered_lines ([]), available_sessions ([]), current_message_id (nil), show_transcript (true)\n- Mount: load available sessions via Ash.read!(Session, sort: [started_at: :desc], limit: 20)\n- Event \"select_session\": load session messages, run TranscriptRenderer.render/1, store rendered_lines\n- Event \"terminal_scrolled\": receive visible_text from JS, find in rendered_lines via substring match, push \"scroll_to_message\" event\n- Template: three-column flex layout — terminal (flex: 2) | transcript (flex: 1) | annotations (flex: 1)\n- Transcript panel: session dropdown selector, message cards with type badge + timestamp + truncated content, active message highlighted\n\nModify assets/js/app.js:\n- Add term.onScroll() with 300ms debounce → extract visible lines from term.buffer.active using getLine(i).translateToString(true) → pushEvent(\"terminal_scrolled\", {visible_text})\n- Add handleEvent(\"scroll_to_message\", {id}) → document.getElementById(\"msg-{id}\").scrollIntoView({behavior: \"smooth\", block: \"center\"})\n\nOutput files:\n- lib/spotter_web/live/pane_view_live.ex (modify)\n- assets/js/app.js (modify)\n\nSource references:\n- lib/spotter_web/live/pane_view_live.ex (current implementation)\n- assets/js/app.js (current Terminal hook)\n- lib/spotter/services/transcript_renderer.ex (from spotter-6vs.3)\n- lib/spotter/transcripts/session.ex (Session resource)\n- lib/spotter/transcripts/message.ex (Message resource)\n\nArchitecture constraints: Phoenix LiveView, Ash queries, xterm.js buffer API.\n\nDefinition of Done:\n- mix compile --warnings-as-errors clean\n- Manual test: open pane, select session, scroll terminal → transcript follows","status":"open","priority":2,"issue_type":"task","owner":"marco.rotili@handgemacht.ai","created_at":"2026-02-11T11:28:44.365778229+01:00","created_by":"Marco Rotili","updated_at":"2026-02-11T11:28:44.365778229+01:00","dependencies":[{"issue_id":"spotter-6vs.4","depends_on_id":"spotter-6vs","type":"parent-child","created_at":"2026-02-11T11:28:44.368777085+01:00","created_by":"Marco Rotili"},{"issue_id":"spotter-6vs.4","depends_on_id":"spotter-6vs.3","type":"blocks","created_at":"2026-02-11T11:28:51.450690477+01:00","created_by":"Marco Rotili"}]}
{"id":"spotter-al1","title":"Split pane view into two-column layout","description":"Modify terminal pane viewer to use 50/50 two-column layout. Left: terminal with window chrome. Right: annotation panel placeholder with background #16213e. Files: lib/spotter_web/live/pane_view_live.ex","status":"closed","priority":2,"issue_type":"task","owner":"marco.rotili@handgemacht.ai","created_at":"2026-02-11T00:12:33.463281479+01:00","created_by":"Marco Rotili","updated_at":"2026-02-11T00:23:32.955741542+01:00","closed_at":"2026-02-11T00:23:32.955741542+01:00","close_reason":"Closed","dependencies":[{"issue_id":"spotter-al1","depends_on_id":"spotter-yku","type":"parent-child","created_at":"2026-02-11T00:12:50.414865098+01:00","created_by":"Marco Rotili"}]}
{"id":"spotter-c59","title":"LiveView pages (pane list + terminal viewer)","description":"Build two LiveView pages: PaneListLive at / showing discovered tmux panes in a table (Claude panes separated, refresh button, empty states), and PaneViewLive at /panes/:pane_id embedding xterm.js via Terminal hook connected to the terminal channel. See plan for full details.","status":"closed","priority":1,"issue_type":"task","owner":"marco.rotili@handgemacht.ai","created_at":"2026-02-10T22:40:13.297848579+01:00","created_by":"Marco Rotili","updated_at":"2026-02-10T22:46:15.981434013+01:00","closed_at":"2026-02-10T22:46:15.981434013+01:00","close_reason":"Closed","dependencies":[{"issue_id":"spotter-c59","depends_on_id":"spotter-mst","type":"blocks","created_at":"2026-02-10T22:40:18.736016267+01:00","created_by":"Marco Rotili"},{"issue_id":"spotter-c59","depends_on_id":"spotter-mzi","type":"blocks","created_at":"2026-02-10T22:40:18.911642446+01:00","created_by":"Marco Rotili"},{"issue_id":"spotter-c59","depends_on_id":"spotter-i7n","type":"blocks","created_at":"2026-02-10T22:40:19.080651754+01:00","created_by":"Marco Rotili"}]}
{"id":"spotter-i7n","title":"Terminal channel for tmux pane streaming","description":"Build SpotterWeb.TerminalChannel -- a Phoenix Channel that connects to a tmux pane via control mode and bidirectionally streams terminal I/O between xterm.js and tmux. Handles join with pane_id validation, output parsing with octal decoding, input forwarding, resize events, and Port lifecycle. See plan for full details.","status":"closed","priority":1,"issue_type":"task","owner":"marco.rotili@handgemacht.ai","created_at":"2026-02-10T22:40:10.85323493+01:00","created_by":"Marco Rotili","updated_at":"2026-02-10T22:46:15.97972508+01:00","closed_at":"2026-02-10T22:46:15.97972508+01:00","close_reason":"Closed","dependencies":[{"issue_id":"spotter-i7n","depends_on_id":"spotter-mst","type":"blocks","created_at":"2026-02-10T22:40:18.439462577+01:00","created_by":"Marco Rotili"},{"issue_id":"spotter-i7n","depends_on_id":"spotter-mzi","type":"blocks","created_at":"2026-02-10T22:40:18.588700164+01:00","created_by":"Marco Rotili"}]}
{"id":"spotter-l65","title":"Terminal scrollback — show full session history in xterm.js","description":"## Problem\nWhen viewing a Claude Code session in Spotter's xterm.js terminal, users can only see the last ~24 lines (the current tmux viewport). The full session history is lost because `tmux capture-pane` is called without scrollback flags, and xterm.js only accumulates content streamed after connection.\n\n## Solution\n1. Use `tmux capture-pane -S -` to capture the full scrollback buffer (not just the visible viewport) on initial load\n2. Increase xterm.js `scrollback` option to handle large histories (e.g. 10,000 lines)\n\n## Acceptance Tests\n- GIVEN a tmux pane with 500+ lines of history WHEN a user opens the pane in Spotter THEN they can scroll up to see all prior output\n- GIVEN a tmux pane with ANSI color codes in history WHEN scrollback is captured THEN colors render correctly in xterm.js\n\n## Rabbit Holes\n- Very large scrollback buffers (100k+ lines) could cause slow initial load or high memory usage. Start with tmux's default history-limit and revisit if needed.\n- Tmux control mode streaming may re-send content that overlaps with the initial capture. Minor visual duplication is acceptable for now.\n\n## No-gos\n- Not implementing infinite scroll / lazy loading of history\n- Not persisting terminal history to a database\n- Not adding search functionality (separate feature)\n\n---\nAppetite: reviewed. Target: lib/spotter/services/tmux.ex, assets/js/app.js, lib/spotter_web/channels/terminal_channel.ex. Architecture: Phoenix channels, xterm.js v6, tmux CLI.","status":"closed","priority":2,"issue_type":"epic","owner":"marco.rotili@handgemacht.ai","created_at":"2026-02-10T23:45:00.274945895+01:00","created_by":"Marco Rotili","updated_at":"2026-02-10T23:49:12.349110671+01:00","closed_at":"2026-02-10T23:49:12.349110671+01:00","close_reason":"Closed"}
{"id":"spotter-l65.1","title":"Capture full tmux scrollback on initial load","description":"Modify `Tmux.capture_pane/1` to capture the full scrollback buffer instead of just the visible viewport.\n\n**Output files**: `lib/spotter/services/tmux.ex`\n\n**Technical specs**:\nChange the `capture_pane` function's tmux command from:\n```\n[\"capture-pane\", \"-t\", pane_id, \"-p\", \"-e\"]\n```\nto:\n```\n[\"capture-pane\", \"-t\", pane_id, \"-p\", \"-e\", \"-S\", \"-\"]\n```\nThe `-S -` flag tells tmux to start capture from the beginning of the scrollback buffer (not just the visible area). The `-` value means \"start of history\".\n\n**Source references**:\n- `lib/spotter/services/tmux.ex` lines 52-59 — current `capture_pane/1` implementation\n\n**Edge cases**:\n- Empty panes (no scrollback) should still work — `-S -` with no history returns the visible content\n- Panes with very large history may return large strings; this is acceptable for now\n\n**Definition of Done**:\n- All requirements in the task description are implemented\n- `Tmux.capture_pane/1` returns full scrollback history, not just visible viewport\n- ANSI escape codes are preserved (the `-e` flag is retained)","status":"closed","priority":2,"issue_type":"task","owner":"marco.rotili@handgemacht.ai","created_at":"2026-02-10T23:45:08.021572627+01:00","created_by":"Marco Rotili","updated_at":"2026-02-10T23:49:12.344428493+01:00","closed_at":"2026-02-10T23:49:12.344428493+01:00","close_reason":"Closed","dependencies":[{"issue_id":"spotter-l65.1","depends_on_id":"spotter-l65","type":"parent-child","created_at":"2026-02-10T23:45:08.025273244+01:00","created_by":"Marco Rotili"}]}
{"id":"spotter-l65.2","title":"Increase xterm.js scrollback buffer","description":"Increase the xterm.js terminal scrollback buffer so it can hold the full tmux history received on initial load.\n\n**Output files**: `assets/js/app.js`\n\n**Technical specs**:\nAdd `scrollback: 10000` to the Terminal constructor options:\n```javascript\nconst term = new Terminal({\n  cursorBlink: true,\n  fontSize: 14,\n  fontFamily: \"'JetBrains Mono', 'Fira Code', 'Cascadia Code', monospace\",\n  scrollback: 10000,\n  theme: { ... }\n})\n```\n10,000 lines is sufficient for most Claude Code sessions while keeping memory usage reasonable.\n\n**Source references**:\n- `assets/js/app.js` lines 10-24 — current Terminal constructor\n\n**Edge cases**:\n- xterm.js handles scrollback gracefully — once the limit is reached, oldest lines are discarded (FIFO)\n\n**Definition of Done**:\n- All requirements in the task description are implemented\n- xterm.js Terminal is created with `scrollback: 10000`\n- User can scroll up through historical content after initial load","status":"closed","priority":2,"issue_type":"task","owner":"marco.rotili@handgemacht.ai","created_at":"2026-02-10T23:45:10.48903737+01:00","created_by":"Marco Rotili","updated_at":"2026-02-10T23:49:12.346852747+01:00","closed_at":"2026-02-10T23:49:12.346852747+01:00","close_reason":"Closed","dependencies":[{"issue_id":"spotter-l65.2","depends_on_id":"spotter-l65","type":"parent-child","created_at":"2026-02-10T23:45:10.492145446+01:00","created_by":"Marco Rotili"}]}
{"id":"spotter-mst","title":"Phoenix LiveView web layer setup","description":"Set up the full Phoenix LiveView web stack. Create endpoint with dual sockets (LiveView + UserSocket), router with browser pipeline, layouts, app.js with Terminal hook for xterm.js, esbuild config, and copy xterm vendor files. See plan for full details.","status":"closed","priority":1,"issue_type":"task","owner":"marco.rotili@handgemacht.ai","created_at":"2026-02-10T22:40:06.524882291+01:00","created_by":"Marco Rotili","updated_at":"2026-02-10T22:46:15.976251875+01:00","closed_at":"2026-02-10T22:46:15.976251875+01:00","close_reason":"Closed"}
{"id":"spotter-mzi","title":"Tmux service for pane discovery","description":"Build Spotter.Services.Tmux -- a pure function module that discovers tmux panes across ALL sessions. Public API: list_panes(), list_claude_panes(), capture_pane(pane_id), send_keys(pane_id, keys), session_for_pane(pane_id). Uses tmux CLI via System.cmd. Handles missing tmux gracefully. See plan for full details.","status":"closed","priority":1,"issue_type":"task","owner":"marco.rotili@handgemacht.ai","created_at":"2026-02-10T22:40:08.324768268+01:00","created_by":"Marco Rotili","updated_at":"2026-02-10T22:46:15.978136248+01:00","closed_at":"2026-02-10T22:46:15.978136248+01:00","close_reason":"Closed"}
{"id":"spotter-rlp","title":"Annotation highlighting in terminal","description":"Click annotation to highlight region in terminal via term.select(). Clear after 2s. Fallback gracefully if API unavailable. Files: assets/js/app.js, lib/spotter_web/live/pane_view_live.ex","status":"closed","priority":2,"issue_type":"task","owner":"marco.rotili@handgemacht.ai","created_at":"2026-02-11T00:12:38.039986572+01:00","created_by":"Marco Rotili","updated_at":"2026-02-11T00:23:32.961171215+01:00","closed_at":"2026-02-11T00:23:32.961171215+01:00","close_reason":"Closed","dependencies":[{"issue_id":"spotter-rlp","depends_on_id":"spotter-1o8","type":"blocks","created_at":"2026-02-11T00:12:44.521869938+01:00","created_by":"Marco Rotili"},{"issue_id":"spotter-rlp","depends_on_id":"spotter-yku","type":"parent-child","created_at":"2026-02-11T00:12:50.893693105+01:00","created_by":"Marco Rotili"}]}
{"id":"spotter-rr8","title":"Add SpotterWeb.ErrorView for 500/404 error pages","description":"Phoenix endpoint references SpotterWeb.ErrorView for rendering error pages, but the module doesn't exist. When any request triggers a 500 (e.g. missing DB table), Phoenix crashes again trying to render the error page. Need to create a basic ErrorView/ErrorHTML module.","status":"closed","priority":2,"issue_type":"bug","owner":"marco.rotili@handgemacht.ai","created_at":"2026-02-11T01:00:40.809880174+01:00","created_by":"Marco Rotili","updated_at":"2026-02-11T01:08:02.323628373+01:00","closed_at":"2026-02-11T01:08:02.323628373+01:00","close_reason":"Closed"}
{"id":"spotter-wum","title":"Create Ash Annotation resource","description":"Create Spotter.Transcripts.Annotation resource with pane_id, selected_text, start_row, start_col, end_row, end_col, comment. Register in Transcripts domain. Generate and run migration. Files: lib/spotter/transcripts/annotation.ex, lib/spotter/transcripts.ex","status":"closed","priority":2,"issue_type":"task","owner":"marco.rotili@handgemacht.ai","created_at":"2026-02-11T00:12:35.247073504+01:00","created_by":"Marco Rotili","updated_at":"2026-02-11T00:23:32.957774107+01:00","closed_at":"2026-02-11T00:23:32.957774107+01:00","close_reason":"Closed","dependencies":[{"issue_id":"spotter-wum","depends_on_id":"spotter-yku","type":"parent-child","created_at":"2026-02-11T00:12:50.576585543+01:00","created_by":"Marco Rotili"}]}
{"id":"spotter-y5l","title":"Link Annotations to Claude Code Session IDs","description":"## Problem\nAnnotations are tied to ephemeral tmux pane_id values like \"%16\". When a pane dies or tmux restarts, annotations become orphaned. We can't correlate annotations with Claude Code sessions or transcripts.\n\n## Solution\nUse a **Claude Code plugin** to notify Spotter of {session_id, pane_id} mappings. The plugin uses a `hooks.json` to declare a SessionStart hook that reads session_id from stdin JSON and $TMUX_PANE from environment, then POSTs to a Phoenix endpoint. Annotations switch from pane_id to session_id as their key.\n\nComponents:\n1. Plugin directory (`spotter-plugin/`) with `hooks.json` + `scripts/notify-session.sh` — POSTs session_id + pane_id to Spotter\n2. Phoenix endpoint (/api/hooks/session-start) — receives and stores the mapping\n3. Schema migration — annotations: replace pane_id with session_id\n4. PaneViewLive — resolve session_id via stored mapping, use for annotation CRUD\n5. scripts/setup_worktree.sh — add `--plugin-dir` flag to claude command (no per-worktree hook copying)\n\n### Plugin Structure\n```\nspotter-plugin/\n├── hooks.json          # Declares SessionStart hook\n└── scripts/\n    └── notify-session.sh  # POSTs session_id + pane_id to Spotter\n```\n\n### Why plugin over bare hooks?\n- Single directory, shared by all worktrees via `--plugin-dir` CLI flag\n- Multiple lifecycle events in one `hooks.json` (extensible for Stop, PostToolUse, etc.)\n- ${CLAUDE_PLUGIN_ROOT} for portable script paths\n- No per-worktree file copying needed\n\n## Acceptance Tests\n- GIVEN Claude Code starts in a tmux pane WHEN SessionStart hook fires THEN Spotter receives session_id + pane_id mapping\n- GIVEN a stored mapping WHEN PaneViewLive mounts for that pane THEN it resolves the session_id\n- GIVEN annotation created with session_id WHEN pane dies and restarts with same session (resume) THEN annotation still loads\n- GIVEN a new worktree WHEN setup_worktree.sh runs THEN claude command includes --plugin-dir flag\n\n## Rabbit Holes\n- Hook script must be async (non-blocking) to not slow Claude startup\n- Server might not be running when hook fires — script should fail silently\n- Session resume vs new session — both fire SessionStart, mapping should upsert\n- Pane ID stability: tmux pane IDs are stable for the pane lifetime but change on pane recreation. The SessionStart hook fires on every start AND resume, so mapping self-heals.\n\n## No-gos\n- No PID/file heuristics for session detection (plugin solves this cleanly)\n- No migration of existing pane_id annotations (clean slate)\n- No error-tracking hooks yet (future work)\n\n---\nRig: spotter. Appetite: reviewed.\nTarget: spotter-plugin/, lib/spotter_web/, lib/spotter/transcripts/, scripts/.\nSources: lib/spotter/transcripts/annotation.ex, lib/spotter/transcripts/session.ex, lib/spotter_web/live/pane_view_live.ex, scripts/setup_worktree.sh.","status":"open","priority":2,"issue_type":"epic","owner":"marco.rotili@handgemacht.ai","created_at":"2026-02-11T11:14:02.036095938+01:00","created_by":"Marco Rotili","updated_at":"2026-02-11T11:27:53.48966104+01:00"}
{"id":"spotter-y5l.1","title":"Create spotter-plugin with SessionStart hook and Phoenix endpoint","description":"Create a Claude Code plugin directory at project root with hooks.json declaring a SessionStart hook. The hook script reads session_id from stdin JSON and $TMUX_PANE from env, POSTs to a new Phoenix endpoint.\n\nStructure:\n```\nspotter-plugin/\n├── hooks.json\n└── scripts/\n    └── notify-session.sh\n```\n\nhooks.json declares SessionStart with command ${CLAUDE_PLUGIN_ROOT}/scripts/notify-session.sh (timeout: 5s).\n\nPhoenix side: add /api/hooks/session-start endpoint that receives {session_id, pane_id} and stores the mapping in a SessionRegistry (ETS or GenServer). Script must fail silently if server is down.","status":"open","priority":2,"issue_type":"task","owner":"marco.rotili@handgemacht.ai","created_at":"2026-02-11T11:14:21.87091141+01:00","created_by":"Marco Rotili","updated_at":"2026-02-11T11:28:00.048694984+01:00","dependencies":[{"issue_id":"spotter-y5l.1","depends_on_id":"spotter-y5l","type":"parent-child","created_at":"2026-02-11T11:14:21.873811985+01:00","created_by":"Marco Rotili"}]}
{"id":"spotter-y5l.2","title":"Migrate annotation schema from pane_id to session_id","description":"Replace pane_id with session_id in the Annotation resource and add bidirectional Ash relationships.\n\n**What and why:** Annotations must reference sessions instead of panes so they persist across tmux restarts and can be viewed alongside transcript data.\n\n**Output files:**\n- priv/repo/migrations/{timestamp}_replace_pane_id_with_session_id.exs (new)\n- lib/spotter/transcripts/annotation.ex (modify)\n- lib/spotter/transcripts/session.ex (modify)\n\n**Technical specs:**\n\nMigration (SQLite can't drop columns, so recreate table):\n```elixir\nexecute(\"CREATE TABLE annotations_v2 (\n  id TEXT PRIMARY KEY,\n  session_id TEXT NOT NULL REFERENCES sessions(id),\n  selected_text TEXT NOT NULL,\n  start_row INTEGER NOT NULL,\n  start_col INTEGER NOT NULL,\n  end_row INTEGER NOT NULL,\n  end_col INTEGER NOT NULL,\n  comment TEXT NOT NULL,\n  inserted_at TEXT NOT NULL,\n  updated_at TEXT NOT NULL\n)\")\nexecute(\"DROP TABLE annotations\")\nexecute(\"ALTER TABLE annotations_v2 RENAME TO annotations\")\nexecute(\"CREATE INDEX annotations_session_id_index ON annotations(session_id)\")\n```\n\nAnnotation resource changes in lib/spotter/transcripts/annotation.ex:\n- Remove: attribute :pane_id, :string, allow_nil?: false\n- Add: attribute :session_id, :uuid, allow_nil?: false\n- Add: belongs_to :session, Spotter.Transcripts.Session\n- Update :create action accept list: replace :pane_id with :session_id\n\nSession resource changes in lib/spotter/transcripts/session.ex:\n- Add: has_many :annotations, Spotter.Transcripts.Annotation\n\n**Source references:**\n- lib/spotter/transcripts/annotation.ex — current schema with pane_id\n- lib/spotter/transcripts/session.ex — session resource\n- priv/repo/migrations/20260210232042_create_annotations.exs — current annotations table\n- priv/repo/migrations/20260210221917_add_transcripts_domain.exs — sessions table schema\n\n**Edge cases:**\n- Existing annotations will be lost (accepted in no-gos)\n- FK constraint: session must exist before annotation can be created — if session not yet synced, annotation create will fail. PaneViewLive must handle this.\n\n**Definition of Done:**\n- [ ] Migration runs cleanly (mix ecto.migrate)\n- [ ] Annotation resource compiles with session_id attribute and belongs_to\n- [ ] Session resource has has_many :annotations\n- [ ] Ash.create(Annotation, %{session_id: uuid, ...}) works when session exists","status":"open","priority":2,"issue_type":"task","owner":"marco.rotili@handgemacht.ai","created_at":"2026-02-11T11:14:32.650009103+01:00","created_by":"Marco Rotili","updated_at":"2026-02-11T11:14:32.650009103+01:00","dependencies":[{"issue_id":"spotter-y5l.2","depends_on_id":"spotter-y5l","type":"parent-child","created_at":"2026-02-11T11:14:32.653041269+01:00","created_by":"Marco Rotili"}]}
{"id":"spotter-y5l.3","title":"Update PaneViewLive to use session_id for annotations","description":"Update PaneViewLive to look up session_id from the SessionRegistry and use it for all annotation operations.\n\n**What and why:** The LiveView currently uses pane_id for annotation CRUD. Must switch to session_id resolved via the hook-populated registry.\n\n**Output files:**\n- lib/spotter_web/live/pane_view_live.ex (modify)\n\n**Technical specs:**\n\nIn mount/3, after existing pane detection:\n```elixir\nsession_id = Spotter.Services.SessionRegistry.get_session_id(pane_id)\nsocket = assign(socket, :session_id, session_id)\n```\n\nSubscribe to PubSub \"pane_sessions\" topic to receive updates if a session registers after mount:\n```elixir\nSpotterWeb.Endpoint.subscribe(\"pane_sessions\")\n```\n\nAdd handle_info for session registration events:\n```elixir\ndef handle_info({:session_registered, pane_id, session_id}, socket) do\n  if pane_id == socket.assigns.pane_id do\n    socket = socket |\u003e assign(:session_id, session_id) |\u003e load_annotations()\n    {:noreply, socket}\n  else\n    {:noreply, socket}\n  end\nend\n```\n\nUpdate load_annotations helper:\n- Filter by session_id == ^session_id instead of pane_id == ^pane_id\n- Return empty list if session_id is nil\n\nUpdate handle_event(\"save_annotation\", ...):\n- Replace pane_id: socket.assigns.pane_id with session_id: socket.assigns.session_id\n- Guard: only allow save when session_id is not nil\n\nUpdate render:\n- Show session ID in pane header (first 8 chars of UUID)\n- When session_id is nil: show \"Waiting for session...\" message\n- When session_id present: show annotation panel as before\n\n**Source references:**\n- lib/spotter_web/live/pane_view_live.ex — current implementation\n- lib/spotter/services/session_registry.ex — from Task 1\n\n**Edge cases:**\n- Session not yet registered (hook hasn't fired) — show \"waiting\" state, update via PubSub\n- Session registered but not in DB (sync hasn't run) — annotation create fails with FK error; show \"Session not yet synced\" message\n- Non-Claude pane — session_id stays nil, annotations hidden\n\n**Definition of Done:**\n- [ ] Opening a Claude pane shows detected session ID after hook fires\n- [ ] Creating annotation stores session_id (not pane_id)\n- [ ] Annotations persist and reload correctly for the same session\n- [ ] Non-Claude panes show appropriate message","status":"open","priority":2,"issue_type":"task","owner":"marco.rotili@handgemacht.ai","created_at":"2026-02-11T11:14:39.077590465+01:00","created_by":"Marco Rotili","updated_at":"2026-02-11T11:14:39.077590465+01:00","dependencies":[{"issue_id":"spotter-y5l.3","depends_on_id":"spotter-y5l","type":"parent-child","created_at":"2026-02-11T11:14:39.079844688+01:00","created_by":"Marco Rotili"},{"issue_id":"spotter-y5l.3","depends_on_id":"spotter-y5l.1","type":"blocks","created_at":"2026-02-11T11:15:01.103923982+01:00","created_by":"Marco Rotili"},{"issue_id":"spotter-y5l.3","depends_on_id":"spotter-y5l.2","type":"blocks","created_at":"2026-02-11T11:15:01.302720657+01:00","created_by":"Marco Rotili"}]}
{"id":"spotter-y5l.4","title":"Add --plugin-dir flag to worktree setup","description":"Update scripts/setup_worktree.sh to pass --plugin-dir pointing to the spotter-plugin/ directory when launching claude in tmux. This replaces per-worktree hook file copying — one shared plugin directory for all worktrees.\n\nChange the tmux send-keys line from:\n  claude --dangerously-skip-permissions\nTo:\n  claude --plugin-dir /home/marco/projects/spotter/spotter-plugin --dangerously-skip-permissions","status":"open","priority":2,"issue_type":"task","owner":"marco.rotili@handgemacht.ai","created_at":"2026-02-11T11:14:55.996140314+01:00","created_by":"Marco Rotili","updated_at":"2026-02-11T11:28:05.561004245+01:00","dependencies":[{"issue_id":"spotter-y5l.4","depends_on_id":"spotter-y5l","type":"parent-child","created_at":"2026-02-11T11:14:55.997793217+01:00","created_by":"Marco Rotili"},{"issue_id":"spotter-y5l.4","depends_on_id":"spotter-y5l.1","type":"blocks","created_at":"2026-02-11T11:15:01.455913025+01:00","created_by":"Marco Rotili"}]}
{"id":"spotter-yku","title":"Terminal Annotations","description":"Split pane view into two-column layout with annotation panel. Users can select terminal text, add comments, and click annotations to highlight regions. Ash resource for persistence, xterm.js integration for selection/highlighting.","status":"closed","priority":2,"issue_type":"epic","owner":"marco.rotili@handgemacht.ai","created_at":"2026-02-11T00:12:23.206825298+01:00","created_by":"Marco Rotili","updated_at":"2026-02-11T00:23:32.962898999+01:00","closed_at":"2026-02-11T00:23:32.962898999+01:00","close_reason":"Closed"}
